# 飞机大战

## 一、流程

### 1、初始化场景

#### 窗口的初始化

~~~c++
	//初始化窗口大小
    setFixedSize(GAME_WIDTH,GAME_HIGHT);
    //窗口标题
    setWindowTitle(GAME_TITLE);
    //设置窗口标题
    setWindowIcon(QIcon(GAEM_ICON));
	//播放背景音乐
    QSound::play(SOUND_BACKGROUND);
~~~

#### 定时器的设置

游戏中所有的敌机与所有的子弹的位置都由定时器的监听者定时更新，定时器的间隔可自由设置。

设置定时器的间隔

~~~c++
	//设置时间间隔
    m_Timer.setInterval(GAME_RATE);
~~~

启动定时器

~~~c++
	m_Timer.start();
~~~

监听定时器

~~~C++
	//监听定时器的信号
    connect(&m_Timer,&QTimer::timeout,[=]()
    {
        //发射敌机
        enemyToScene();
        //更新游戏中所有元素的坐标
        updatePosition();
        //绘制游戏中的元素
        update();//会调用paintEvent函数
        //碰撞检测
        collisionDetechion();
    });
~~~

### 2、游戏资源的加载

主场景中有很多的物体，包括敌机，我方飞机，子弹（我方飞机发射之后才显示出来），主要将物体的所对应的资源加载进来就可以完成，资源的加载。但是这个时候所有的资源都是静止的，他们的运行依赖于监听器。当然运动的规则则是他们自己的属性，例如我方飞机发射的子弹只能沿着Y轴的负方向移动。

### 3、游戏的运行

游戏主要主要规则就是玩家用鼠标操控我方的飞机来躲避敌机的碰撞或者击落敌机（本游戏目前还没有给敌方飞机增加血量和发射子弹的属性，相当于我方的飞机处于无敌状态）。所以要让敌机不断的出现，我方的飞机不断的发射子弹，而且地图还要一直变化。

#### 敌机的不断出现

设置一个敌机数组，敌机有一个`isFree`属性，这个属性决定飞机是否显示在屏幕之上，当他为false的时候表示他不在空闲状态，那么他就要显示在屏幕上。当他的位置出现在了程序框之外或者被击落，就将isfree设置为true，等待下一次的出现。这样做的好处就在于所有的敌机都是可以循环利用的，减少了敌机对象的new和delete。

#### 子弹的飞行

子弹的原理和敌机的原理差不多，也是一个数组。也有一个isFree属性，当他飞出屏幕之外或者打到敌机，那么他就进入下一次的循环。

#### 我方飞机的控制

我方飞机的控制是由鼠标来控制的，所以需要监听鼠标的事件，让我方飞机的位置跟随鼠标，就完成了我方飞机的控制。

## 二、一些我认为好的技术点

### 1、碰撞检测

要想让敌机能够被击落，就必须实现敌机和我方飞机发射的子弹的碰撞检测。这个实现的原理是在飞机和子弹的外面套一个矩形框，框的大小和对应资源的大小一致。然后每隔一个时间间隔检测在场的敌机的矩形框和子弹的矩形框是否相交。如果相交就同时将该子弹和该飞机的isFree属性设置为true，然后播放敌机爆炸特效。

### 2、爆炸特效的播放

真正的爆炸特效应该是播放一个视频，但是这样做有一些复杂，所以采用另一种方式来形成爆炸特效，视频就是快速的播放一组图片，由于人类的眼睛有视觉暂留效果，所以就形成了视频。所以此处的爆炸特效就是在极短的时间内播放一组图片。

### 3、资源的压缩

在QT中要想使用资源就必须先将资源传入qrc文件，但是这样会有一个问题就是如果该程序使用到了很多的资源，就会造成程序的编译失败。所以将这些资源转化为二进制的rcc文件，然后再将它加载进程序。使用的是MinGW自带的rcc功能。在命令行进入到qrc文件所在的文件夹中。输入

~~~bash
 rcc -binary xxx.qrc -o xxx.rcc
~~~

然后将rcc文件和资源文件一同放到exe文件的上一级目录，即debug和release下。

在主场景加载之前就将资源文件加载到程序中。即在main（）函数中加载。

~~~c++
//注册二进制文件的头文件
#include <QResource>

//注册外部二进制资源文件
QResource::registerResource(GAME_RES_PATH);
~~~

